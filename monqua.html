<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>🎁 Quà thưởng cho em</title>
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3E%E2%9D%A4%EF%B8%8F%3C/text%3E%3C/svg%3E">
  <style>
    :root{ --rose:#d63384; --bg1:#fff0f5; --bg2:#ffe4ec; }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:"Segoe UI",system-ui,Arial,sans-serif;
      background:linear-gradient(180deg,var(--bg1),var(--bg2));
      min-height:100vh; overflow:hidden; color:#8a4760;
    }
    .wrap{display:flex;align-items:center;justify-content:center;min-height:100vh;padding:24px}
    .card{
      position:relative; max-width:800px; width:min(92vw,800px);
      background:rgba(255,255,255,.85); border:1.5px solid #ffd6e8;
      border-radius:18px; padding:22px 20px; text-align:center;
      box-shadow:0 16px 40px rgba(255,92,138,.18); backdrop-filter:blur(6px);
      z-index:2;
    }
    h1{margin:8px 0 6px; color:var(--rose)}
    p.msg{margin:10px auto; line-height:1.6; font-size:18px}
    .btns{margin-top:14px; display:flex; gap:10px; justify-content:center; flex-wrap:wrap}
    button,a.btn{
      background:var(--rose); color:#fff; border:none; border-radius:12px;
      padding:10px 16px; font-weight:800; cursor:pointer; text-decoration:none;
      box-shadow:0 6px 16px rgba(255,92,138,.18);
    }
    button:hover,a.btn:hover{filter:brightness(1.05)}
    /* Hoa rơi */
    .petal{position:fixed; top:-40px; width:14px; height:14px; pointer-events:none; z-index:1;
      background:radial-gradient(circle at 30% 30%,#ffd1e1 0%,#ff9fc5 60%,#ff7aa7 100%);
      border-radius:60% 40% 60% 40%; opacity:.9; transform:rotate(45deg);
      animation: fall linear forwards, sway ease-in-out infinite;
    }
    @keyframes fall { to{ transform:translateY(110vh) rotate(405deg); opacity:.2 } }
    @keyframes sway { 0%{ margin-left:0 } 50%{ margin-left:12px } 100%{ margin-left:0 } }
    /* Nút bật nhạc khi bị chặn autoplay */
    .music-tip{margin-top:8px; font-size:14px; opacity:.8}
  </style>
</head>
<body>
  <audio id="bgm" src="music/3.mp3" loop></audio>
  <!-- THÊM: chuông báo hết giờ nghỉ -->
  <audio id="alert" src="music/alert.mp3" preload="auto"></audio>

  <div class="wrap">
    <div class="card">
      <h1>🎁 GIỎI LẮM CÔ GÁI CỦA ANH </h1>
      <p class="msg">
        Em vừa hoàn thành một “ca học” siêu đỉnh rồi đó — 4 pomodoro liên tiếp, đáng nể luôn 😘 Anh biết em đã tập trung hết mình, nên giờ là lúc cho phép bản thân chậm lại một chút nha. Hít sâu một hơi, thả lỏng vai, nhắm mắt vài giây, để tâm trí được nghỉ ngơi sau chặng dài cố gắng. Uống một ngụm nước mát, bật bản nhạc em thích, để giai điệu nhẹ nhàng chạm vào tim như phần thưởng xứng đáng cho cô gái chăm chỉ nhất của anh 💞 Anh thật sự tự hào về em — không chỉ vì em học giỏi, mà vì cách em kiên trì, nỗ lực và luôn giữ trái tim dịu dàng giữa mọi áp lực. Em xứng đáng với từng giây phút thư giãn này, xứng đáng được yêu thương, được trân trọng. Giỏi lắm, cô gái nhỏ của anh 🌷💖
      </p>

      <!-- THÊM: đồng hồ nghỉ dài -->
      <div id="longTimerBox" style="margin-top:10px;">
        <div style="font-weight:800;color:#d63384;">⏳ Nghỉ dài còn:</div>
        <div id="longTime" style="font-size:28px;font-weight:900;color:#8a4760;">30:00</div>
        <div id="longMsg" class="music-tip" hidden>⏰ Hết giờ nghỉ rồi! Quay lại học nhé 💪</div>
      </div>

      <div class="btns">
        <!-- đổi link để tự bắt đầu Pomodoro mới khi quay lại -->
        <a class="btn" href="study.html?start=1">⬅️ Quay lại học cùng anh</a>
        <button id="playMusic">🎵 Bật nhạc</button>
      </div>
      <div class="music-tip" id="musicTip" hidden>Nhấn “Bật nhạc” nếu trình duyệt chặn tự phát.</div>
    </div>
  </div>

  <script>
    // Hoa rơi
    function spawnPetal(){
      const p = document.createElement('div');
      p.className = 'petal';
      const left = Math.random() * 100;
      p.style.left = left + 'vw';
      const dur = 8 + Math.random()*8;
      const delay = Math.random()*4;
      p.style.animationDuration = dur + 's, ' + (3 + Math.random()*2) + 's';
      p.style.animationDelay = delay + 's, 0s';
      document.body.appendChild(p);
      setTimeout(() => p.remove(), (dur + delay) * 1000 + 500);
    }
    setInterval(spawnPetal, 300);
    for(let i=0;i<20;i++) spawnPetal();

    // Nhạc nền
    const bgm = document.getElementById('bgm');
    const tip = document.getElementById('musicTip');
    const btn = document.getElementById('playMusic');
    function tryPlay(){
      bgm.volume = 0.9;
      bgm.play().then(()=>{ tip.hidden = true; }).catch(()=>{ tip.hidden = false; });
    }
    document.addEventListener('DOMContentLoaded', tryPlay);
    btn.addEventListener('click', tryPlay);

    // THÊM: Đồng hồ nghỉ dài 30 phút
    const longEl = document.getElementById('longTime');
    const longMsg = document.getElementById('longMsg');
    const alertEl = document.getElementById('alert');
    const LONG_SEC = 30 * 60;

    // mốc kết thúc để chống trôi khi tab ẩn
    let endTs = Date.now() + LONG_SEC * 1000;
    let longId = null;

    function fmt(s){
      const m = String(Math.floor(s/60)).padStart(2,'0');
      const ss = String(Math.floor(s%60)).padStart(2,'0');
      return m + ':' + ss;
    }
    function tickLong(){
      const remain = Math.max(0, Math.round((endTs - Date.now())/1000));
      longEl.textContent = fmt(remain);
      if (remain <= 0){
        clearInterval(longId); longId = null;
        // báo chuông + thông báo
        try {
          alertEl.currentTime = 0;
          alertEl.play().catch(()=>{});
        } catch {}
        try {
          if ('Notification' in window && Notification.permission === 'granted'){
            new Notification('Hết giờ nghỉ ⏰', { body: 'Quay lại học thôi nào! 💪' });
          } else if ('Notification' in window && Notification.permission === 'default'){
            Notification.requestPermission().catch(()=>{});
          }
        } catch {}
        longMsg.hidden = false;
        document.title = '⏰ Hết giờ nghỉ — quay lại học!';
      }
    }
    // chạy timer
    longId = setInterval(tickLong, 250);
    tickLong();
    document.addEventListener('visibilitychange', () => { if (longId) tickLong(); });
  </script>
</body>
</html>
