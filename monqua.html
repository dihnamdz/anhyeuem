<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ğŸ QuÃ  thÆ°á»Ÿng cho em</title>
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3E%E2%9D%A4%EF%B8%8F%3C/text%3E%3C/svg%3E">
  <style>
    :root{ --rose:#d63384; --bg1:#fff0f5; --bg2:#ffe4ec; }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:"Segoe UI",system-ui,Arial,sans-serif;
      background:linear-gradient(180deg,var(--bg1),var(--bg2));
      min-height:100vh; overflow:hidden; color:#8a4760;
    }
    .wrap{display:flex;align-items:center;justify-content:center;min-height:100vh;padding:24px}
    .card{
      position:relative; max-width:800px; width:min(92vw,800px);
      background:rgba(255,255,255,.85); border:1.5px solid #ffd6e8;
      border-radius:18px; padding:22px 20px; text-align:center;
      box-shadow:0 16px 40px rgba(255,92,138,.18); backdrop-filter:blur(6px);
      z-index:2;
    }
    h1{margin:8px 0 6px; color:var(--rose)}
    p.msg{margin:10px auto; line-height:1.6; font-size:18px}
    .btns{margin-top:14px; display:flex; gap:10px; justify-content:center; flex-wrap:wrap}
    button,a.btn{
      background:var(--rose); color:#fff; border:none; border-radius:12px;
      padding:10px 16px; font-weight:800; cursor:pointer; text-decoration:none;
      box-shadow:0 6px 16px rgba(255,92,138,.18);
    }
    button:hover,a.btn:hover{filter:brightness(1.05)}
    /* Hoa rÆ¡i */
    .petal{position:fixed; top:-40px; width:14px; height:14px; pointer-events:none; z-index:1;
      background:radial-gradient(circle at 30% 30%,#ffd1e1 0%,#ff9fc5 60%,#ff7aa7 100%);
      border-radius:60% 40% 60% 40%; opacity:.9; transform:rotate(45deg);
      animation: fall linear forwards, sway ease-in-out infinite;
    }
    @keyframes fall { to{ transform:translateY(110vh) rotate(405deg); opacity:.2 } }
    @keyframes sway { 0%{ margin-left:0 } 50%{ margin-left:12px } 100%{ margin-left:0 } }
    /* NÃºt báº­t nháº¡c khi bá»‹ cháº·n autoplay */
    .music-tip{margin-top:8px; font-size:14px; opacity:.8}
  </style>
</head>
<body>
  <audio id="bgm" src="music/3.mp3" loop></audio>
  <!-- THÃŠM: chuÃ´ng bÃ¡o háº¿t giá» nghá»‰ -->
  <audio id="alert" src="music/alert.mp3" preload="auto"></audio>

  <div class="wrap">
    <div class="card">
      <h1>ğŸ GIá»I Láº®M CÃ” GÃI Cá»¦A ANH </h1>
      <p class="msg">
        Em vá»«a hoÃ n thÃ nh má»™t â€œca há»câ€ siÃªu Ä‘á»‰nh rá»“i Ä‘Ã³ â€” 4 pomodoro liÃªn tiáº¿p, Ä‘Ã¡ng ná»ƒ luÃ´n ğŸ˜˜ Anh biáº¿t em Ä‘Ã£ táº­p trung háº¿t mÃ¬nh, nÃªn giá» lÃ  lÃºc cho phÃ©p báº£n thÃ¢n cháº­m láº¡i má»™t chÃºt nha. HÃ­t sÃ¢u má»™t hÆ¡i, tháº£ lá»ng vai, nháº¯m máº¯t vÃ i giÃ¢y, Ä‘á»ƒ tÃ¢m trÃ­ Ä‘Æ°á»£c nghá»‰ ngÆ¡i sau cháº·ng dÃ i cá»‘ gáº¯ng. Uá»‘ng má»™t ngá»¥m nÆ°á»›c mÃ¡t, báº­t báº£n nháº¡c em thÃ­ch, Ä‘á»ƒ giai Ä‘iá»‡u nháº¹ nhÃ ng cháº¡m vÃ o tim nhÆ° pháº§n thÆ°á»Ÿng xá»©ng Ä‘Ã¡ng cho cÃ´ gÃ¡i chÄƒm chá»‰ nháº¥t cá»§a anh ğŸ’ Anh tháº­t sá»± tá»± hÃ o vá» em â€” khÃ´ng chá»‰ vÃ¬ em há»c giá»i, mÃ  vÃ¬ cÃ¡ch em kiÃªn trÃ¬, ná»— lá»±c vÃ  luÃ´n giá»¯ trÃ¡i tim dá»‹u dÃ ng giá»¯a má»i Ã¡p lá»±c. Em xá»©ng Ä‘Ã¡ng vá»›i tá»«ng giÃ¢y phÃºt thÆ° giÃ£n nÃ y, xá»©ng Ä‘Ã¡ng Ä‘Æ°á»£c yÃªu thÆ°Æ¡ng, Ä‘Æ°á»£c trÃ¢n trá»ng. Giá»i láº¯m, cÃ´ gÃ¡i nhá» cá»§a anh ğŸŒ·ğŸ’–
      </p>

      <!-- THÃŠM: Ä‘á»“ng há»“ nghá»‰ dÃ i -->
      <div id="longTimerBox" style="margin-top:10px;">
        <div style="font-weight:800;color:#d63384;">â³ Nghá»‰ dÃ i cÃ²n:</div>
        <div id="longTime" style="font-size:28px;font-weight:900;color:#8a4760;">30:00</div>
        <div id="longMsg" class="music-tip" hidden>â° Háº¿t giá» nghá»‰ rá»“i! Quay láº¡i há»c nhÃ© ğŸ’ª</div>
      </div>

      <div class="btns">
        <!-- Ä‘á»•i link Ä‘á»ƒ tá»± báº¯t Ä‘áº§u Pomodoro má»›i khi quay láº¡i -->
        <a class="btn" href="study.html?start=1">â¬…ï¸ Quay láº¡i há»c cÃ¹ng anh</a>
        <button id="playMusic">ğŸµ Báº­t nháº¡c</button>
      </div>
      <div class="music-tip" id="musicTip" hidden>Nháº¥n â€œBáº­t nháº¡câ€ náº¿u trÃ¬nh duyá»‡t cháº·n tá»± phÃ¡t.</div>
    </div>
  </div>

  <script>
    // Hoa rÆ¡i
    function spawnPetal(){
      const p = document.createElement('div');
      p.className = 'petal';
      const left = Math.random() * 100;
      p.style.left = left + 'vw';
      const dur = 8 + Math.random()*8;
      const delay = Math.random()*4;
      p.style.animationDuration = dur + 's, ' + (3 + Math.random()*2) + 's';
      p.style.animationDelay = delay + 's, 0s';
      document.body.appendChild(p);
      setTimeout(() => p.remove(), (dur + delay) * 1000 + 500);
    }
    setInterval(spawnPetal, 300);
    for(let i=0;i<20;i++) spawnPetal();

    // Nháº¡c ná»n
    const bgm = document.getElementById('bgm');
    const tip = document.getElementById('musicTip');
    const btn = document.getElementById('playMusic');
    function tryPlay(){
      bgm.volume = 0.9;
      bgm.play().then(()=>{ tip.hidden = true; }).catch(()=>{ tip.hidden = false; });
    }
    document.addEventListener('DOMContentLoaded', tryPlay);
    btn.addEventListener('click', tryPlay);

    // THÃŠM: Äá»“ng há»“ nghá»‰ dÃ i 30 phÃºt
    const longEl = document.getElementById('longTime');
    const longMsg = document.getElementById('longMsg');
    const alertEl = document.getElementById('alert');
    const LONG_SEC = 30 * 60;

    // má»‘c káº¿t thÃºc Ä‘á»ƒ chá»‘ng trÃ´i khi tab áº©n
    let endTs = Date.now() + LONG_SEC * 1000;
    let longId = null;

    function fmt(s){
      const m = String(Math.floor(s/60)).padStart(2,'0');
      const ss = String(Math.floor(s%60)).padStart(2,'0');
      return m + ':' + ss;
    }
    function tickLong(){
      const remain = Math.max(0, Math.round((endTs - Date.now())/1000));
      longEl.textContent = fmt(remain);
      if (remain <= 0){
        clearInterval(longId); longId = null;
        // bÃ¡o chuÃ´ng + thÃ´ng bÃ¡o
        try {
          alertEl.currentTime = 0;
          alertEl.play().catch(()=>{});
        } catch {}
        try {
          if ('Notification' in window && Notification.permission === 'granted'){
            new Notification('Háº¿t giá» nghá»‰ â°', { body: 'Quay láº¡i há»c thÃ´i nÃ o! ğŸ’ª' });
          } else if ('Notification' in window && Notification.permission === 'default'){
            Notification.requestPermission().catch(()=>{});
          }
        } catch {}
        longMsg.hidden = false;
        document.title = 'â° Háº¿t giá» nghá»‰ â€” quay láº¡i há»c!';
      }
    }
    // cháº¡y timer
    longId = setInterval(tickLong, 250);
    tickLong();
    document.addEventListener('visibilitychange', () => { if (longId) tickLong(); });
  </script>
</body>
</html>
